# DMI 交易系统技术说明书

## 一、系统参数设置

### 1. 均线参数
```
N1:=13; N2:=21; N3:=26; N4:=30; N5:=34; 
N6:=40; N7:=45; N8:=50; N9:=55; N10:=60; 
N11:=65; N12:=70; N13:=75; N14:=80; N15:=89;
```
系统使用15条不同周期的均线，周期从13天到89天不等，用于捕捉不同级别的支撑位。

### 2. DMI参数
```
N_DMI1:=14,NODRAW;  { 14天DMI周期 }
N_DMI2:=7,NODRAW;   { 7天DMI周期 }
```
使用双周期DMI系统，分别是14天和7天，用于同时捕捉中期和短期趋势。

### 3. ATR止盈止损参数
```
ATR周期:=14,NODRAW;            { ATR计算周期 }
止盈倍数:=1.2,NODRAW;          { 止盈ATR倍数 }
止损倍数:=1.2,NODRAW;          { 止损ATR倍数 }
```

## 二、核心计算逻辑

### 1. ATR计算与止盈止损位
```
TR1:=MAX(MAX((H-L),ABS(H-REF(C,1))),ABS(L-REF(C,1))),NODRAW;
盈损率:MA(TR1,ATR周期),NODRAW;
止盈:REF(C,1)+盈损率*止盈倍数,NODRAW;
止损:REF(C,1)-盈损率*止损倍数,NODRAW;
```
- TR1: 计算真实波幅，取最高价与最低价差值、当前最高价与前收盘价差值、当前最低价与前收盘价差值三者中的最大值
- 盈损率: 对TR1进行14周期移动平均
- 止盈/止损: 以前一日收盘价为基准，上下浮动1.2倍ATR

### 2. DMI指标计算（以14周期为例）
```
MTR14:=SUM(MAX(MAX(HIGH-LOW,ABS(HIGH-REF(CLOSE,1))),ABS(REF(CLOSE,1)-LOW)),N_DMI1);
HD14:=HIGH-REF(HIGH,1);
LD14:=REF(LOW,1)-LOW;
DMP14:=SUM(IF(HD14>0&&HD14>LD14,HD14,0),N_DMI1);
DMM14:=SUM(IF(LD14>0&&LD14>HD14,LD14,0),N_DMI1);
PDI14:=DMP14*100/MTR14;
MDI14:=DMM14*100/MTR14;
```
计算步骤：
1. MTR14: 计算14天真实波幅之和
2. HD14/LD14: 计算上升动向和下降动向
3. DMP14/DMM14: 计算正向和负向动量
4. PDI14/MDI14: 计算最终的方向指标

### 3. 均线接触次数统计
```
COUNT1:=SUM(IF(ABS(LOWEST-MA1)<0.001,1,0), 21);
COUNT2:=SUM(IF(ABS(LOWEST-MA2)<0.001,1,0), 21);
...
```
统计21天内最低价与各均线的接触次数，接触判定标准为价差小于0.001。

## 三、信号系统

### 1. 买入信号条件
```
买点:ADX<35 AND PDI14<25 AND PDI7<25 AND 
     CROSS(SELECTED_PDI,SELECTED_MDI) AND 
     SELECTED_MA>REF(SELECTED_MA,1),COLORWHITE,POINTDOT;
```
买入条件需同时满足：
- ADX小于35（趋势强度适中）
- 两个周期的PDI都小于25（上升动能未过强）
- 选定的PDI上穿MDI（方向转换）
- 选定的均线向上（趋势向上）

### 2. 止盈止损信号
```
触及止盈:=C>止盈,NODRAW;
触及止损:=C<止损,NODRAW;
```
价格突破止盈止损位时发出信号。

### 3. 底部确认系统
```
极品底:=A2>0.04 AND A4>0.04;
XG1T:=极品底 AND XGT;
底部一次确认:XG1T AND 极品,COLORYELLOW;
二次确认:IF(CROSS(RSI,11),70,0) AND REF(底部一次确认,1);
```
- 一次确认：价格与均线偏离度超过4%且满足其他技术条件
- 二次确认：RSI从11以下上穿且已有一次确认信号

## 四、显示系统

### 1. 信号标注
```
DRAWTEXT(买点,L,'买点'),COLORYELLOW;
DRAWTEXT(触及止盈,止盈标注位,'止盈'),COLORRED;
DRAWTEXT(触及止损,止损标注位,'止损'),COLORGREEN;
```
- 买点：黄色标注
- 止盈：红色标注
- 止损：绿色标注

### 2. 均线显示
```
引线:SELECTED_MA,COLORGREEN,LINETHICK2;
引线1:SELECTED_MA1,COLORGREEN,LINETHICK2;
```
选定的重要均线用绿色粗线显示。

## 五、使用注意事项

1. 信号确认
- 必须等待多重信号共振
- 确认趋势方向
- 注意成交量配合

2. 止损纪律
- 价格触及止损位必须执行止损
- 止损位随ATR动态调整
- 不建议人为调整止损位置

3. 系统局限性
- 适合趋势明确的市场
- 震荡市可能产生虚假信号
- 剧烈波动时期需谨慎使用

## 六、参数优化建议

1. 均线周期
- 可根据交易品种特性调整
- 建议保持周期间距
- 短期均线可适当加密

2. ATR参数
- 止盈止损倍数可根据波动率调整
- 大波动市场可适当放大倍数
- 建议回测不同参数组合

3. DMI参数
- 短周期可在5-10之间调整
- 长周期可在12-20之间调整
- 需要保持两个周期的合理比例 